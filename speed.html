<!DOCTYPE html>
<html>
<head>
    <title>Current City Weather</title>
    <script>
        function showPosition(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            document.getElementById("location").innerHTML = "Latitude: " + latitude + "<br>Longitude: " + longitude;

            var url = "https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=" + latitude + "&lon=" + longitude;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    var city = data.address.city;
                    if (city) {
                        document.getElementById('city').innerHTML = 'City: ' + city;
                        getWeather(city); // Pass the city to the getWeather() function
                    } else {
                        document.getElementById('city').innerHTML = 'City not found';
                    }
                })
                .catch(error => {
                    document.getElementById('city').innerHTML = 'Error: ' + error.message;
                });
        }

        function showError(error) {
            document.getElementById("location").innerHTML = "Error: " + error.message;
        }

        function updateLocation() {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        }

        setInterval(updateLocation, 60000); // update location every 1 minute (60 seconds)

        function getWeather(city) {
            // Make a request to the weather API to get the weather data
            // Replace 'YOUR_API_KEY' with your actual API key
            var weatherAPIUrl = 'https://api.weatherapi.com/v1/current.json?key=ad8caecea06c43d1912181938230407&q=' + encodeURIComponent(city);

            fetch(weatherAPIUrl)
                .then(response => response.json())
                .then(data => {
                    // Get the weather icon code from the API response
                    var weatherIcon = data.current.condition.icon;

                    // Create an <img> element for the weather icon
                    var weatherImg = document.createElement("img");
                    weatherImg.src = "https:" + weatherIcon;

                    // Append the weather icon to the weatherContainer div
                    var weatherContainer = document.getElementById("weatherContainer");
                    weatherContainer.innerHTML = ''; // Clear previous weather icon, if any
                    weatherContainer.appendChild(weatherImg);
                });
        }

        function handleMotion(event) {
            // Handle device motion events here
        }

        window.addEventListener('devicemotion', handleMotion, true);

        function updateDateTime() {
            var currentDateTime = new Date().toLocaleString();
            document.getElementById("dateTime").innerHTML = currentDateTime;
        }

        setInterval(updateDateTime, 1000); // update date and time every second
    </script>
</head>
<body>
    <h1 id="dateTime"></h1>
    <h2>Current City Weather</h2>
    <p id="city">Locating...</p>
    <div id="weatherContainer"></div>
    <p id="location"></p>
</body>
</html>
